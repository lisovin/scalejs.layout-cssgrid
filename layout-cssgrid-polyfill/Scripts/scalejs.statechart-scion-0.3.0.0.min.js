define("scalejs.statechart-scion/state.builder",["scalejs!core","scion"],function(t,n){return function(e){function r(t){return A(function(n){if(n.onEntry)throw new Error("Only one `onEntry` action is allowed.");if("function"!=typeof t)throw new Error("`onEntry` takes a function as a parameter.");return n.onEntry=t,n})}function o(t){return A(function(n){if(n.onExit)throw new Error("Only one `onExit` action is allowed.");if("function"!=typeof t)throw new Error("`onExit` takes a function as a parameter.");return n.onExit=t,n})}function i(t){return A(function(n){n.event=t})}function a(t){return A(function(n){n.cond=t})}function u(t,n,e){return A(function(r){return"state"===r.type||"parallel"===r.type?v(u(t,n,e))(r):(t&&(r.type="internal"),"function"==typeof n?r.onTransition=n:(r.target=S(n,"array")?n:n.split(" "),e&&(r.onTransition=e)),void 0)})}function s(t,n){return u(!1,t,n)}function c(t,n){return u(!0,t,n)}function f(t){if("function"==typeof t)return A(function(n){n.onTransition=t});if("$yield"===t.kind)return t;throw new Error("Unsupported transition action",t)}function l(){var t,n=b.copy(arguments),e=n.pop();if(n.length>2)throw new Error("First (optional) argument should be event name, second (optional) argument should be a condition function");if("function"!=typeof e&&"$yield"!==e.kind)throw new Error("Last argument should be either `goto` or a function.");return t=n.map(function(t){if("string"==typeof t)return i(t);if("function"==typeof t)return a(t);throw new Error("Transition argument ",t," is not supported. First (optional) argument should be event name, second (optional) argument should be a condition function")}),A(v.apply(null,t.concat([f(e)])))}function p(){var t=b.copy(arguments),n=t.pop();if(t.forEach(function(t){if("string"!=typeof t)throw new Error("`whenInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof n&&"$yield"!==n.kind)throw new Error("Last argument should be either `goto` or a function.");return A(v(a(function(n,e){return t.every(function(t){return e(t)})}),n))}function d(){var t=b.copy(arguments),n=t.pop();if(t.forEach(function(t){if("string"!=typeof t)throw new Error("`whenNotInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof n&&"$yield"!==n.kind)throw new Error("Last argument should be either `goto` or a function.");return A(v(a(function(n,e){return t.every(function(t){return!e(t)})}),n))}function g(t){return A(function(n){return n.parallel?new Error("`initial` shouldn't be specified on parallel region."):(n.initial=t,void 0)})}function h(e){return function(){var r=E.apply(null,arguments);return new n.Statechart(r,j({log:t.log.debug},e))}}var y,w,E,m,v,b=t.array,x=t.object.has,S=t.type.is,j=t.object.merge,k=t.functional.builder,A=k.$yield;return y=k({run:function(t,n){var e=new function(){};return e.type=x(n,"parallel")?"parallel":"state",t(e),e},delay:function(t){return t()},zero:function(){return function(){}},$yield:function(t){return t},combine:function(t,n){return function(e){t(e),n(e)}},missing:function(t){if("string"==typeof t)return function(n){if(n.id)throw new Error("Can't set state id to \""+t+'". '+"state's id is already set to \""+n.id+'"');n.id=t};if("function"==typeof t)return t;if("state"===t.type||"parallel"===t.type)return function(n){n.states||(n.states=[]),n.states.push(t)};throw new Error("Missing builder for expression: "+JSON.stringify(t))}}),E=y(),m=y({parallel:!0}),w=k({run:function(t){return function(n){n.transitions||(n.transitions=[]);var e={};t(e),n.transitions.push(e)}},delay:function(t){return t()},zero:function(){return function(){}},$yield:function(t){return t},combine:function(t,n){return function(e){t(e),n(e)}},missing:function(t){if("function"==typeof t)return t;throw new Error('Unknown operation "'+t.kind+'" in transition expression',t)}}),v=w(),{builder:h,state:E,parallel:m,initial:g,onEntry:r,onExit:o,on:l,whenInStates:p,whenNotInStates:d,"goto":s,gotoInternally:c,statechart:h({logStatesEnteredAndExited:e.logStatesEnteredAndExited,log:t.log.debug})}}}),define("scalejs.statechart-scion/state",["scalejs!core","./state.builder","scion","scalejs.functional"],function(t,n,e){return function(r){function o(t){return m(t,"states")?y.make(t).concat(y.from(t.states).selectMany(o)):y.make(t)}function i(t,n){var e=o(t).firstOrDefault(function(t){return t.id===n});return e}function a(t,n){var e=o(t).firstOrDefault(function(t){return t.states&&t.states.some(function(t){return t.id===n})});return e}function u(){return b(function(t,n){var e,r;if(e=i(g,t),!e)throw new Error('Parent state "'+t+"\" doesn't exist");if(m(n,"id")&&(r=i(g,n.id)))throw new Error('State "'+n.id+'" already exists.');m(e,"states")||(e.states=[]),e.states.push(n)}).apply(null,arguments)}function s(n){if(t.isApplicationRunning())throw new Error("Can't register a state while application is running.");w(arguments,1).forEach(u(n))}function c(t,n){var e;if(e=i(g,t),!e)throw new Error('Parent state "'+t+"\" doesn't exist");n.expr(e)}function f(){if(t.isApplicationRunning())throw new Error("Can't unregister a state while application is running.");w(arguments).forEach(function(t){var n=a(g,t),e=y.from(n.states).first(function(n){return n.id===t});E(n.states,e)})}function l(t,n,e){var r;if(v(t,"string"))r={name:t};else{if(!v(t,"name"))throw new Error("event object should have `name` property.");r=t}!m(e)&&v(n,"number")?e=n:r.data=n,h.send(r,{delay:e})}function p(){return t.reactive.Observable.create(function(t){var n={onEntry:function(n){t.onNext({event:"entry",state:n,context:this})},onExit:function(n){t.onNext({event:"exit",state:n})},onTransition:function(n,e){t.onNext({event:"transition",source:n,targets:e})}};return h.registerListener(n),function(){h.unregisterListener(n)}})}function d(t){return function(n){p().where(function(n){return"entry"===n.event&&n.state===t}).take(1).subscribe(function(){n()})}}var g,h,y=t.linq.enumerable,w=t.array.toArray,E=t.array.removeOne,m=t.object.has,v=t.type.is,b=t.functional.curry,x=n(r),S=x.state,j=x.parallel;return g=S("scalejs-app",j("root")),t.onApplicationEvent(function(n){switch(n){case"started":h=new e.Statechart(g,{logStatesEnteredAndExited:r.logStatesEnteredAndExited,log:t.log.debug}),h.start();break;case"stopped":}}),{registerStates:s,registerTransition:c,unregisterStates:f,raise:l,observe:p,onState:d,builder:x}}}),define("scalejs.statechart-scion",["scalejs!core","./scalejs.statechart-scion/state","module"],function(t,n,e){t.registerExtension({state:n(e.config())})});