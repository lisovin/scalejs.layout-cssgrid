// knockout-classBindingProvider 0.5.0 | (c) 2013 Ryan Niemeyer |  http://www.opensource.org/licenses/mit-license

!function(e){"function"==typeof define&&define.amd?define("scalejs.mvvm/classBindingProvider",["knockout","exports"],e):e(ko)}(function(e,n){var t=function(e,n){var t,i;if(!e)return e;t={};for(i in e)e.hasOwnProperty(i)&&(t[i]=n(e[i],i,e));return t},i=function(e){return function(){return e}};e.version>="3.0.0"&&function(){var n=document.createElement("div");e.applyBindings(null,n);var t=e.contextFor(n),i=!e.storedBindingContextForNode,r=i?"A":"_subscribable",s=i?"wb":"_addNode",a=function(){};a[s]=a,t.constructor.prototype[r]=a,e.cleanNode(n)}();var r=function(n,r){var s=new e.bindingProvider;r=r||{},this.attribute=r.attribute||"data-class",this.virtualAttribute="ko "+(r.virtualAttribute||"class")+":",this.fallback=r.fallback,this.bindings=n||{},this.bindingRouter=r.bindingRouter||function(e,n){var t,i,r,s;if(n[e])return n[e];for(r=e.split("."),s=n,t=0,i=r.length;i>t;t++)s=s[r[t]];return s},this.registerBindings=function(n){e.utils.extend(this.bindings,n)},this.nodeHasBindings=function(e){var n,t;return 1===e.nodeType?n=e.getAttribute(this.attribute):8===e.nodeType&&(t=""+e.nodeValue||e.text,n=t.indexOf(this.virtualAttribute)>-1),!n&&this.fallback&&(n=s.nodeHasBindings(e)),n},this.getBindingsFunction=function(n){return function(a,o){var c,l,d,u,f,g,b={},m="";if(1===a.nodeType?m=a.getAttribute(this.attribute):8===a.nodeType&&(f=""+a.nodeValue||a.text,g=f.indexOf(this.virtualAttribute),g>-1&&(m=f.substring(g+this.virtualAttribute.length))),m)for(m=m.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"").replace(/(\s|\u00A0){2,}/g," ").split(" "),c=0,l=m.length;l>c;c++)d=this.bindingRouter(m[c],this.bindings),d?(u="function"==typeof d?d.call(o.$data,o,m):d,n&&(u=t(u,i)),e.utils.extend(b,u)):r.log&&r.log('No binding function provided for data class "'+m[c]+'" in element ',a,"\nMake sure data class is spelled correctly and that it's binding function is registered.");else this.fallback&&(b=s[n?"getBindingAccessors":"getBindings"](a,o));if(r.log)for(bindingName in b)b.hasOwnProperty(bindingName)&&"_ko_property_writers"!==bindingName&&"valueUpdate"!==bindingName&&"optionsText"!==bindingName&&!e.bindingHandlers[bindingName]&&(u?r.log('Unknown binding handler "'+bindingName+'" found in element',a,' defined in data-class "'+m+'" as',u,"\nMake sure that binding handler's name is spelled correctly and that it's properly registered. \nThe binding will be ignored."):r.log('Unknown binding handler "'+bindingName+'" in',a,"\nMake sure that it's name spelled correctly and that it's properly registered. \nThe binding will be ignored."));return b}},this.getBindings=this.getBindingsFunction(!1),this.getBindingAccessors=this.getBindingsFunction(!0)};return n||(e.classBindingProvider=r),r}),define("scalejs.mvvm/htmlTemplateSource",["knockout","scalejs!core"],function(e,n){function t(e){var n=document.createElement("div");n.innerHTML=e,r(n.childNodes).forEach(function(e){1===e.nodeType&&s(e,"id")&&(o[e.id]=e.innerHTML)})}function i(e){function n(n,t){return s(o.data,e)||(o.data[e]={}),1===arguments.length?o.data[e][n]:(o.data[e][n]=t,void 0)}function t(n){if(0===arguments.length)return o[e];throw new Error('An attempt to override template "'+e+'" with content "'+n+'" '+"Template overriding is not supported.")}return{data:n,text:t}}var r=n.array.toArray,s=n.object.has,a=new e.nativeTemplateEngine,o={data:{}};return a.makeTemplateSource=i,e.setTemplateEngine(a),{registerTemplates:t}}),define("scalejs.mvvm/selectableArray",["knockout","scalejs!core"],function(e,n){var t=e.isObservable,i=e.utils.unwrapObservable,r=e.observable,s=e.computed,a=n.object.has,o=n.array;return function(e,n){function c(e){if(!t(e.isSelected)||a(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath){if(t(e.isSelected))throw new Error('item has observable `isSelected` property but `isSelectedPath` specified as "'+n.isSelectedPath+'". `selectable` uses `isSelected` property of an item '+"to determine whether it's selected. Either don't specify `isSelectedPath` or "+"rename `isSelected` property to something else.");if(e.hasOwnProperty("isSelected"))throw new Error("item has non-observable `isSelected` property. `selectable` uses `isSelected` property of an item to determine whether it's selected. Either make `isSelected` observable or rename it.");if(e.isSelected=r(),a(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath&&!t(e[n.isSelectedPath]))throw new Error("item's property \""+n.isSelectedPath+'" specified by `isSelectedPath` '+" isn't observable. Either make it observable or specify different property in "+" `isSelectedPath`");a(n.isSelectedPath)&&(e.isSelected=e[n.isSelectedPath]),e.isSelected.subscribe(function(n){n?d(e):d()===e&&d(void 0)})}}n=n||{};var l,d=n.selectedItem||r(),u=n.selectionPolicy||"single";return t(e)?l=s(function(){var n=i(e);return n.forEach(c),o.copy(n)}):(e.forEach(c),l=o.copy(e)),d.subscribe(function(e){i(l).forEach(function(n){n.isSelected(n===e)}),"deselect"===u&&e&&setTimeout(function(){d(void 0)},0)}),l.selectedItem=d,l}}),define("scalejs.mvvm/ko.utils",["scalejs!core","knockout"],function(e,n){function t(t,i){return e.array.toArray(t).map(function(e){var t=e.cloneNode(!0);return i?n.cleanNode(t):t})}return{cloneNodes:t}}),define("scalejs.mvvm/mvvm",["knockout","knockout.mapping","scalejs!core","scalejs.mvvm/classBindingProvider","./htmlTemplateSource","./selectableArray","./ko.utils"],function(e,n,t,i,r,s,a){function o(n){return e.observable(n)}function c(n){return e.observableArray(n)}function l(n){return e.computed(n)}function d(e){return n.toJSON(e)}function u(e){return JSON.parse(d(e))}function f(){k(arguments).forEach(w.registerBindings.bind(w))}function g(e,t,i){var r=Object.keys(i).reduce(function(e,n){return y(e,{k:n,create:function(e){return i[n](e.data)}})},{});return n.fromJS(e,r,t)}function b(){k(arguments).forEach(r.registerTemplates)}function m(e,n){var t={};return t[e]=n,t}function p(e,n){return m("template",{name:e,data:n})}function h(e,n){return{dataClass:e,viewmodel:n}}function v(){var n=document.getElementsByTagName("body")[0];n.innerHTML="<!-- ko class: scalejs-shell --><!-- /ko -->",f({"scalejs-shell":function(e){return{render:e.$data.root}}}),e.applyBindings({root:S})}var y=t.object.merge,k=t.array.toArray,w=new i({},{log:t.log.warn,fallback:!0}),S=e.observable();return e.bindingProvider.instance=w,{core:{mvvm:{toJson:d,registerBindings:f,registerTemplates:b,dataClass:h,template:p,dataBinding:m,selectableArray:s,ko:{utils:a}}},sandbox:{mvvm:{observable:o,observableArray:c,computed:l,registerBindings:f,registerTemplates:b,toJson:d,toViewModel:g,toObject:u,dataClass:h,template:p,dataBinding:m,selectableArray:s,root:S}},init:v}}),define("scalejs.bindings/change",["knockout","scalejs!core"],function(e,n){function t(n,t,s,a){function o(e,t){return function(i){i!==t&&(t=i,e.call(a,i,n))}}function c(t,i){e.computed({read:function(){var e=f(a[t]);i(e)},disposeWhenNodeIsRemoved:n})}if(r(a)){var l,d,u,f=e.utils.unwrapObservable,g=t(),b=f(g);for(l in b)b.hasOwnProperty(l)&&(d=b[l],i(d.initial,"function")&&d.initial.apply(a,[f(a[l]),n]),i(d.update,"function")&&(u=o(d.update,f(a[l]))),i(d,"function")&&(u=o(d,f(a[l]))),u&&c(l,u))}}var i=n.type.is,r=n.object.has;return{init:t}}),define("scalejs.bindings/render",["scalejs!core","knockout","scalejs.functional"],function(e,n){function t(){return{controlsDescendantBindings:!0}}function i(e,t,i,l,d){function u(t){g?n.applyBindingsToNode(e,g,l):n.utils.emptyDomNode(e),window.requestAnimationFrame(t)}var f,g,b,m,p,h=a(t()),v=[],y=[];if(b=n.utils.domData.get(e,"binding"),h)if(r(h.dataClass,"string")){if(f=n.bindingProvider.instance.bindingRouter(h.dataClass),!f)throw new Error("Don't know how to render binding \""+h.dataClass+'" - no such binding registered. '+"Either register the bindng or correct its name.");f&&(g=r(f,"function")?f.call(h.viewmodel||l,d):f)}else g=r(h,"function")?h.call(l,d):h;s(b,"transitions","outTransitions")&&(y=b.transitions.outTransitions.map(function(e){return c(e)})),s(g,"transitions","inTransitions")&&(v=g.transitions.inTransitions.map(function(e){return c(e)})),p=o.apply(null,y.concat(c(u)).concat(v)),m={getElement:function(){return e}},p.call(m),n.utils.domData.set(e,"binding",g)}var r=e.type.is,s=e.object.has,a=n.utils.unwrapObservable,o=e.functional.builders.complete,c=e.functional.builder.$DO;return{init:t,update:i}}),define("scalejs.mvvm",["scalejs!core","knockout","scalejs.mvvm/mvvm","./scalejs.bindings/change","./scalejs.bindings/render"],function(e,n,t,i,r){n.bindingHandlers.change=i,n.bindingHandlers.render=r,n.virtualElements.allowedBindings.change=!0,n.virtualElements.allowedBindings.render=!0,t.init(),e.registerExtension(t)});